{"version":3,"file":"local-storage.js","sourceRoot":"","sources":["../../../src/cli/services/local-storage.ts"],"names":[],"mappings":"AAAA,OAAO,EAAC,YAAY,EAAC,MAAM,qCAAqC,CAAA;AAChE,OAAO,EAAC,WAAW,EAAE,aAAa,EAAE,WAAW,EAAC,MAAM,8BAA8B,CAAA;AACpF,OAAO,EAAC,aAAa,EAAC,MAAM,4BAA4B,CAAA;AAkBxD,IAAI,wBAAyE,CAAA;AAE7E,SAAS,eAAe;IACtB,IAAI,CAAC,wBAAwB,EAAE;QAC7B,wBAAwB,GAAG,IAAI,YAAY,CAAwB,EAAC,WAAW,EAAE,iBAAiB,EAAC,CAAC,CAAA;KACrG;IACD,OAAO,wBAAwB,CAAA;AACjC,CAAC;AAED,MAAM,UAAU,UAAU,CACxB,SAAiB,EACjB,SAA8C,eAAe,EAAE;IAE/D,MAAM,UAAU,GAAG,aAAa,CAAC,SAAS,CAAC,CAAA;IAC3C,WAAW,CAAC,aAAa,CAAA,gDAAgD,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAA;IAC3G,OAAO,MAAM,CAAC,GAAG,CAAC,UAAU,CAAC,CAAA;AAC/B,CAAC;AAED,MAAM,UAAU,YAAY,CAAC,SAAiB,EAAE,SAA8C,eAAe,EAAE;IAC7G,MAAM,UAAU,GAAG,aAAa,CAAC,SAAS,CAAC,CAAA;IAC3C,WAAW,CAAC,aAAa,CAAA,0CAA0C,WAAW,CAAC,IAAI,CAAC,UAAU,CAAC,KAAK,CAAC,CAAA;IACrG,MAAM,CAAC,MAAM,CAAC,UAAU,CAAC,CAAA;AAC3B,CAAC;AAED,MAAM,UAAU,eAAe,CAAC,SAA8C,eAAe,EAAE;IAC7F,WAAW,CAAC,aAAa,CAAA,iCAAiC,CAAC,CAAA;IAC3D,MAAM,CAAC,KAAK,EAAE,CAAA;AAChB,CAAC;AAED,MAAM,UAAU,UAAU,CACxB,OAAsB,EACtB,SAA8C,eAAe,EAAE;IAE/D,OAAO,CAAC,SAAS,GAAG,aAAa,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA;IACpD,WAAW,CACT,aAAa,CAAA,yCAAyC,WAAW,CAAC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,IAAI,WAAW,CAAC,IAAI,CAC3G,OAAO,CACR,EAAE,CACJ,CAAA;IACD,MAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,SAAS,CAAC,CAAA;IAC9C,IAAI,QAAQ,EAAE;QACZ,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,SAAS,EAAE;YAC5B,GAAG,QAAQ;YACX,GAAG,OAAO;SACX,CAAC,CAAA;KACH;SAAM;QACL,MAAM,CAAC,GAAG,CAAC,OAAO,CAAC,SAAS,EAAE,OAAO,CAAC,CAAA;KACvC;AACH,CAAC;AAED,MAAM,UAAU,sBAAsB,CACpC,SAAiB,EACjB,SAA8C,eAAe,EAAE;IAE/D,MAAM,UAAU,GAAG,aAAa,CAAC,SAAS,CAAC,CAAA;IAC3C,MAAM,QAAQ,GAAG,MAAM,CAAC,GAAG,CAAC,UAAU,CAAC,CAAA;IACvC,MAAM,CAAC,GAAG,CAAC,UAAU,EAAE;QACrB,GAAG,QAAQ;QACX,UAAU,EAAE,SAAS;KACtB,CAAC,CAAA;AACJ,CAAC","sourcesContent":["import {LocalStorage} from '@shopify/cli-kit/node/local-storage'\nimport {outputDebug, outputContent, outputToken} from '@shopify/cli-kit/node/output'\nimport {normalizePath} from '@shopify/cli-kit/node/path'\n\nexport interface CachedAppInfo {\n  directory: string\n  configFile?: string\n  appId?: string\n  title?: string\n  orgId?: string\n  storeFqdn?: string\n  updateURLs?: boolean\n  tunnelPlugin?: string\n}\n\n// We store each app info using the directory as the key\nexport interface AppLocalStorageSchema {\n  [key: string]: CachedAppInfo\n}\n\nlet _appLocalStorageInstance: LocalStorage<AppLocalStorageSchema> | undefined\n\nfunction appLocalStorage() {\n  if (!_appLocalStorageInstance) {\n    _appLocalStorageInstance = new LocalStorage<AppLocalStorageSchema>({projectName: 'shopify-cli-app'})\n  }\n  return _appLocalStorageInstance\n}\n\nexport function getAppInfo(\n  directory: string,\n  config: LocalStorage<AppLocalStorageSchema> = appLocalStorage(),\n): CachedAppInfo | undefined {\n  const normalized = normalizePath(directory)\n  outputDebug(outputContent`Reading cached app information for directory ${outputToken.path(normalized)}...`)\n  return config.get(normalized)\n}\n\nexport function clearAppInfo(directory: string, config: LocalStorage<AppLocalStorageSchema> = appLocalStorage()): void {\n  const normalized = normalizePath(directory)\n  outputDebug(outputContent`Clearing app information for directory ${outputToken.path(normalized)}...`)\n  config.delete(normalized)\n}\n\nexport function clearAllAppInfo(config: LocalStorage<AppLocalStorageSchema> = appLocalStorage()): void {\n  outputDebug(outputContent`Clearing all app information...`)\n  config.clear()\n}\n\nexport function setAppInfo(\n  options: CachedAppInfo,\n  config: LocalStorage<AppLocalStorageSchema> = appLocalStorage(),\n): void {\n  options.directory = normalizePath(options.directory)\n  outputDebug(\n    outputContent`Storing app information for directory ${outputToken.path(options.directory)}:${outputToken.json(\n      options,\n    )}`,\n  )\n  const savedApp = config.get(options.directory)\n  if (savedApp) {\n    config.set(options.directory, {\n      ...savedApp,\n      ...options,\n    })\n  } else {\n    config.set(options.directory, options)\n  }\n}\n\nexport function clearCurrentConfigFile(\n  directory: string,\n  config: LocalStorage<AppLocalStorageSchema> = appLocalStorage(),\n): void {\n  const normalized = normalizePath(directory)\n  const savedApp = config.get(normalized)\n  config.set(normalized, {\n    ...savedApp,\n    configFile: undefined,\n  })\n}\n"]}